General notes
=============

All numbers are in little-endian.

The client and server both send messages of the following form:

• uint16_t message_id

A number representing the type of message. These are described below.

• uint16_t payload_length

The number of bytes in the message payload not including these two fields.

• payload

The format of the payload depends on the message ID.

A player in the game is distinct from the network connection. The
intention is that if the connection is dropped then the client can
reconnect and recover without creating a new player. Instead a player
is identified by a 64-bit ID which is randomly generated by the
server. When connecting the client can either request a new player or
it can send this ID in order to continue with a previous player.

When a position is described by either the server or the client it is
given as a uint32_t where 0 represents the bottom-leftmost position
and UINT32_MAX+1 represents the top-rightmost position. The players
also have a direction which is represented as a uint16_t where 0 is
directly east and increasing numbers turn counter-clockwise up to
UINT16_MAX+1 which represents a full turn.

The client completely controls its own position and direction and only
informs the server of changes. The server doesn't do any checks
against cheating such as walking through walls. The server only
reports information about the other players.

Messages to the server
======================

The client initiates the communication by sending one of the following
messages:

NEW_PLAYER (0x1000)
-------------------

• Empty payload

This should be sent when the client first starts and hasn't tried
connecting before. The server will create a player ID and send it in a
PLAYER_ID message.

RECONNECT (0x1001)
------------------

• uint64_t player_id

This should be sent if the connection is dropped in order to resume.
The player_id must be a valid ID given from a previous PLAYER_ID
message from the server. If the server hasn't heard of this ID or the
player has been lost then it will generate a new ID instead as if
NEW_PLAYER was sent.

UPDATE_POSITION (0x1002)
------------------------

• uint32_t x_position
• uint32_t y_position
• uint16_t direction

Sent by the client whenever the player has moved.

Messages to the client
======================

PLAYER_ID (0x0000)
------------------

• uint64_t player_id

This is sent as the first message in response to a NEW_PLAYER command
in order to report the player's ID. If the player instead sends a
RECONNECT message this won't be sent unless the player was lost in
which case a new player ID will be generated. Therefore the client
should be prepared to update its player ID whenever this message is
received.

CONSISTENT (0x0001)
-------------------

• No payload

This is sent once the server has sent enough update messages that the
client has a consistent state that can be drawn. This is used to avoid
the client painting with a partially updated state for example if a
player's appearance depends on multiple messages.

N_PLAYERS (0x0002)
------------------

• uint16_t n_players

Sent by the server to update the number of players that are currently
connected.

PLAYER_POSITION (0x0003)
------------------------

• uint16_t player_num
• uint32_t x_position
• uint32_t y_position
• uint16_t direction

Sent by the server whenever another player has moved. This is not sent
when the client's own player moves.
